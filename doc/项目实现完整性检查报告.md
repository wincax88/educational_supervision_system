项目实现完整性检查报告
一、核心问题概览
严重程度	问题数量	说明
🔴 关键缺失	3	核心关联功能未实现
🟠 功能缺失	5	重要业务逻辑缺失
🟡 待优化	4	增强性功能缺失
二、关键缺失（必须修复）
🔴 1. 表单字段与数据指标的关联未实现
问题： FormToolEdit 中的"评价依据"只是UI空壳，没有实际功能。
// 第724-736行 - 只是占位UI，无业务逻辑
<Select defaultValue="数据指标">
  <Select.Option value="数据指标">数据指标</Select.Option>
</Select>
<Button>输入</Button>  // 无事件处理
<Button>添加</Button>  // 无事件处理
影响：
表单字段无法关联到指标体系
数据填报时无法校验指标阈值
"表单→指标"的核心链路断裂
需要的修复：
数据库：添加 form_field_to_data_indicator 关联表
后端：添加字段映射 API
前端：实现指标选择和映射功能
🔴 2. 要素库与表单设计器未集成
问题： ElementLibrary 只能展示要素，无法在表单设计时使用。 影响：
要素库成为孤立模块，无法发挥作用
基础要素无法复用到表单
派生要素的公式无法关联
需要的修复：
在 FormToolEdit 中添加要素库选择器
FormField 接口添加 elementId 字段
实现要素到表单字段的映射
🔴 3. 项目与采集工具的关联缺失
问题： 数据库只有 projects.indicator_system_id，缺少与 data_tools 的关联。 影响：
无法定义"项目使用哪些表单"
填报入口无法自动加载项目对应的表单
需要的修复：
-- 缺少的关联表
CREATE TABLE project_to_data_tool (
  id TEXT PRIMARY KEY,
  project_id TEXT NOT NULL,
  data_tool_id TEXT NOT NULL,
  FOREIGN KEY (project_id) REFERENCES projects(id),
  FOREIGN KEY (data_tool_id) REFERENCES data_tools(id)
);
三、功能缺失（重要）
🟠 1. 派生要素公式计算未实现
现状： 数据库有 elements.formula 字段，种子数据也有公式定义：
{ name: '生师比', formula: 'E003 / E004' }
{ name: '高级职称教师占比', formula: '(E005 / E004) * 100' }
缺失：
无公式解析引擎
无变量替换逻辑
前端无自动计算功能
🟠 2. 数据指标阈值校验未实现
现状： data_indicators.threshold 存储 "≤0.50"、"≥95%" 等阈值 缺失：
无阈值解析器（比较符、百分比、区间）
DataEntryForm 只有基本的 number 校验（第283-289行）
后端提交时无阈值验证
🟠 3. 佐证资料上传不完整
现状： 虽有 uploaded_materials 表和 file 字段类型 缺失：
后端无文件上传 API（POST /api/submissions/:id/upload-material）
无文件类型/大小验证
前端无佐证资料清单展示
🟠 4. 缺失的后端 API
功能	缺失的 API
字段映射	POST/DELETE /api/tools/:id/fields/:fieldId/map-indicator
要素使用	POST /api/tools/:id/use-library/:libraryId
项目表单	GET/POST /api/projects/:id/forms
材料上传	POST /api/submissions/:id/upload-material
🟠 5. FormField 接口不完整
当前定义 toolService.ts:
interface FormField {
  id: string;
  type: ControlType;
  label: string;
  // ... 基本属性
}
缺少的字段：
interface FormField {
  // ... 现有字段
  dataIndicatorId?: string;     // 关联的数据指标
  threshold?: string;           // 阈值（用于校验提示）
  elementId?: string;           // 关联的要素
  formula?: string;             // 计算公式
  validationRules?: {           // 扩展校验规则
    thresholdOperator?: '≤' | '≥' | '=' | '>' | '<';
    thresholdValue?: number;
  };
}
四、待优化（增强）
🟡 1. 审核流程缺少权限控制
后端无用户权限验证
无法限制审核操作
🟡 2. 缺少审核历史记录
submissions 表缺少 approved_by、rejected_by
无审计日志表
🟡 3. 缺少批量操作
无批量审核/驳回
无批量导出功能
🟡 4. 数据版本管理缺失
无法查看修改历史
无法对比数据变更
五、修复优先级建议
第一阶段（核心功能）
├── 1. 添加表单字段←→指标映射（数据库+API+前端）
├── 2. 实现阈值校验逻辑
└── 3. 完善佐证资料上传

第二阶段（重要功能）
├── 4. 实现派生要素计算引擎
├── 5. 添加项目←→表单关联
└── 6. 要素库与表单设计器集成

第三阶段（增强功能）
├── 7. 权限控制
├── 8. 审核历史记录
└── 9. 批量操作功能
六、数据库补充建议
-- 1. 表单字段与数据指标映射
CREATE TABLE form_field_to_data_indicator (
  id TEXT PRIMARY KEY,
  form_id TEXT NOT NULL,
  field_id TEXT NOT NULL,
  data_indicator_id TEXT NOT NULL,
  FOREIGN KEY (form_id) REFERENCES data_tools(id),
  FOREIGN KEY (data_indicator_id) REFERENCES data_indicators(id)
);

-- 2. 表单字段与要素映射
CREATE TABLE form_field_to_element (
  id TEXT PRIMARY KEY,
  form_id TEXT NOT NULL,
  field_id TEXT NOT NULL,
  element_id TEXT NOT NULL,
  FOREIGN KEY (form_id) REFERENCES data_tools(id),
  FOREIGN KEY (element_id) REFERENCES elements(id)
);

-- 3. 项目与采集工具关联
CREATE TABLE project_to_data_tool (
  id TEXT PRIMARY KEY,
  project_id TEXT NOT NULL,
  data_tool_id TEXT NOT NULL,
  FOREIGN KEY (project_id) REFERENCES projects(id),
  FOREIGN KEY (data_tool_id) REFERENCES data_tools(id)
);

-- 4. 审核日志
CREATE TABLE submission_audits (
  id TEXT PRIMARY KEY,
  submission_id TEXT NOT NULL,
  action TEXT,
  actor_name TEXT,
  timestamp TEXT,
  FOREIGN KEY (submission_id) REFERENCES submissions(id)
);
七、总结
项目当前状态：各模块独立可用，但核心关联未打通
模块	独立功能	关联功能
指标体系	✅ 完整	❌ 与表单无关联
要素库	✅ 基本可用	❌ 与表单无集成
采集表单	✅ 设计器可用	❌ 字段无指标/要素映射
数据填报	✅ 基本功能	❌ 无阈值校验、材料上传不完整
项目管理	✅ 有指标关联	❌ 无表单关联
核心问题： 三个核心概念（指标、要素、表单）之间的"粘合剂"严重缺失，导致系统无法形成完整的业务闭环。